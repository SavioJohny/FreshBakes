{% extends 'base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar admin-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-alt"></i>
            <h3>Admin Panel</h3>
        </div>
        <nav class="sidebar-nav">
            <a href="{{ url_for('admin.dashboard') }}" class="nav-item active">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="{{ url_for('admin.pending_approvals') }}" class="nav-item">
                <i class="fas fa-user-check"></i> Approvals
                {% if pending_bakeries > 0 %}<span class="badge">{{ pending_bakeries }}</span>{% endif %}
            </a>
            <a href="{{ url_for('admin.bakeries') }}" class="nav-item">
                <i class="fas fa-store"></i> Bakeries
            </a>
            <a href="{{ url_for('admin.users') }}" class="nav-item">
                <i class="fas fa-users"></i> Users
            </a>
            <a href="{{ url_for('admin.orders') }}" class="nav-item">
                <i class="fas fa-box"></i> Orders
            </a>
            <a href="{{ url_for('admin.reviews') }}" class="nav-item">
                <i class="fas fa-star"></i> Reviews
            </a>
            <a href="{{ url_for('admin.coupons') }}" class="nav-item">
                <i class="fas fa-percent"></i> Coupons
            </a>
            <a href="{{ url_for('admin.messages') }}" class="nav-item">
                <i class="fas fa-envelope"></i> Messages
                {% if new_messages > 0 %}<span class="badge">{{ new_messages }}</span>{% endif %}
            </a>
            <a href="{{ url_for('admin.reports') }}" class="nav-item">
                <i class="fas fa-chart-bar"></i> Reports
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="dashboard-header">
            <h1>Admin Dashboard</h1>
            <p>Platform overview and management</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid stats-grid-4">
            <div class="stat-card">
                <div class="stat-icon users"><i class="fas fa-users"></i></div>
                <div class="stat-info">
                    <span class="stat-value">{{ total_users }}</span>
                    <span class="stat-label">Total Users</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon bakeries"><i class="fas fa-store"></i></div>
                <div class="stat-info">
                    <span class="stat-value">{{ approved_bakeries }}</span>
                    <span class="stat-label">Active Bakeries</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orders"><i class="fas fa-box"></i></div>
                <div class="stat-info">
                    <span class="stat-value">{{ today_orders }}</span>
                    <span class="stat-label">Today's Orders</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon revenue"><i class="fas fa-rupee-sign"></i></div>
                <div class="stat-info">
                    <span class="stat-value">₹{{ '%.0f'|format(today_revenue) }}</span>
                    <span class="stat-label">Today's Revenue</span>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Pending Approvals -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-user-clock"></i> Pending Approvals</h2>
                    <a href="{{ url_for('admin.pending_approvals') }}">View All</a>
                </div>
                {% if pending_approvals %}
                <div class="approval-list">
                    {% for bakery in pending_approvals %}
                    <div class="approval-item">
                        <div class="approval-info">
                            <strong>{{ bakery.name }}</strong>
                            <span>{{ bakery.city }} • {{ bakery.created_at.strftime('%b %d') }}</span>
                        </div>
                        <div class="approval-actions">
                            <form action="{{ url_for('admin.approve_bakery', bakery_id=bakery.id) }}" method="POST"
                                style="display:inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-success btn-sm"><i
                                        class="fas fa-check"></i></button>
                            </form>
                            <a href="{{ url_for('admin.bakery_detail', bakery_id=bakery.id) }}"
                                class="btn btn-secondary btn-sm">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No pending approvals</p>
                {% endif %}
            </div>

            <!-- Platform Stats -->
            <div class="dashboard-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-pie"></i> Platform Stats</h2>
                </div>
                <div class="quick-stats">
                    <div class="quick-stat">
                        <span class="label">Customers</span>
                        <span class="value">{{ total_customers }}</span>
                    </div>
                    <div class="quick-stat">
                        <span class="label">Bakers</span>
                        <span class="value">{{ total_bakers }}</span>
                    </div>
                    <div class="quick-stat">
                        <span class="label">Total Orders</span>
                        <span class="value">{{ total_orders }}</span>
                    </div>
                    <div class="quick-stat">
                        <span class="label">Total Revenue</span>
                        <span class="value">₹{{ '%.0f'|format(total_revenue) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Recent Orders</h2>
                <a href="{{ url_for('admin.orders') }}">View All</a>
            </div>
            <div class="orders-table">
                <table>
                    <thead>
                        <tr>
                            <th>Order #</th>
                            <th>Customer</th>
                            <th>Bakery</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in recent_orders %}
                        <tr>
                            <td><strong>{{ order.order_number }}</strong></td>
                            <td>{{ order.customer.name }}</td>
                            <td>{{ order.bakery.name }}</td>
                            <td>₹{{ '%.0f'|format(order.total_amount) }}</td>
                            <td><span class="status-badge status-{{ order.status }}">{{ order.status.replace('_', '
                                    ').title() }}</span></td>
                            <td>{{ order.created_at.strftime('%b %d, %I:%M %p') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>
{% endblock %}