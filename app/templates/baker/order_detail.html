{% extends 'base.html' %}

{% block title %}Order #{{ order.order_number }}{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {% include 'baker/_sidebar.html' %}

    <main class="dashboard-main">
        <div class="dashboard-header">
            <h1>Order #{{ order.order_number }}</h1>
            <span class="status-badge status-{{ order.status }}">{{ order.status.replace('_', ' ').title() }}</span>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-xl);">
            <!-- Order Items -->
            <div class="dashboard-section">
                <h3><i class="fas fa-shopping-bag"></i> Order Items</h3>
                <div class="orders-table" style="margin-top: var(--space-lg);">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.items %}
                            <tr>
                                <td>{{ item.product_name }}</td>
                                <td>₹{{ '%.0f'|format(item.unit_price) }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>₹{{ '%.0f'|format(item.subtotal) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3"><strong>Subtotal</strong></td>
                                <td><strong>₹{{ '%.0f'|format(order.subtotal) }}</strong></td>
                            </tr>
                            <tr>
                                <td colspan="3">Delivery Fee</td>
                                <td>₹{{ '%.0f'|format(order.delivery_fee) }}</td>
                            </tr>
                            {% if order.discount > 0 %}
                            <tr style="color: var(--accent);">
                                <td colspan="3">Discount</td>
                                <td>-₹{{ '%.0f'|format(order.discount) }}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td colspan="3"><strong>Total</strong></td>
                                <td><strong>₹{{ '%.0f'|format(order.total_amount) }}</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                {% if order.special_instructions %}
                <div
                    style="margin-top: var(--space-lg); padding: var(--space-md); background: var(--gray-50); border-radius: var(--radius-md);">
                    <strong><i class="fas fa-sticky-note"></i> Special Instructions:</strong>
                    <p style="margin-top: var(--space-sm);">{{ order.special_instructions }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Customer & Actions -->
            <div>
                <div class="dashboard-section">
                    <h3><i class="fas fa-user"></i> Customer</h3>
                    <p style="margin-top: var(--space-md);"><strong>{{ order.customer.name }}</strong></p>
                    <p>{{ order.customer.phone }}</p>
                    <p>{{ order.customer.email }}</p>
                </div>

                <div class="dashboard-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
                    {% if order.delivery_address %}
                    <p style="margin-top: var(--space-md);">{{ order.delivery_address.full_address }}</p>
                    <p>{{ order.delivery_address.city }} - {{ order.delivery_address.pincode }}</p>
                    {% if order.delivery_address.landmark %}
                    <p><small>Landmark: {{ order.delivery_address.landmark }}</small></p>
                    {% endif %}
                    {% endif %}
                </div>

                <div class="dashboard-section">
                    <h3><i class="fas fa-clock"></i> Update Status</h3>
                    <form action="{{ url_for('baker.update_order_status', order_id=order.id) }}" method="POST"
                        style="margin-top: var(--space-md);">
<div class="form-group">
                            <select name="status" class="form-control">
                                <option value="pending" {% if order.status=='pending' %}selected{% endif %}>Pending
                                </option>
                                <option value="confirmed" {% if order.status=='confirmed' %}selected{% endif %}>
                                    Confirmed</option>
                                <option value="preparing" {% if order.status=='preparing' %}selected{% endif %}>
                                    Preparing</option>
                                <option value="ready" {% if order.status=='ready' %}selected{% endif %}>Ready for Pickup
                                </option>
                                <option value="out_for_delivery" {% if order.status=='out_for_delivery' %}selected{%
                                    endif %}>Out for Delivery</option>
                                <option value="delivered" {% if order.status=='delivered' %}selected{% endif %}>
                                    Delivered</option>
                                <option value="cancelled" {% if order.status=='cancelled' %}selected{% endif %}>
                                    Cancelled</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-sync"></i> Update Status
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <a href="{{ url_for('baker_orders') }}" class="btn btn-secondary" style="margin-top: var(--space-xl);">
            <i class="fas fa-arrow-left"></i> Back to Orders
        </a>
    </main>
</div>
{% endblock %}