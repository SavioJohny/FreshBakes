{% extends 'base.html' %}

{% block title %}Categories{% endblock %}

{% block body_class %}dashboard-page{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {% include 'baker/_sidebar.html' %}

    <main class="dashboard-main">
        <div class="dashboard-header">
            <h1>Categories</h1>
            <button class="btn btn-primary" onclick="document.getElementById('addCategoryModal').style.display='flex'">
                <i class="fas fa-plus"></i> Add Category
            </button>
        </div>

        {% if categories %}
        <div class="orders-table">
            <table>
                <thead>
                    <tr>
                        <th>Order</th>
                        <th>Name</th>
                        <th>Products</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                    <tr>
                        <td>{{ category.display_order }}</td>
                        <td><strong>{{ category.name }}</strong></td>
                        <td>{{ category.products.count() }}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm"
                                onclick="editCategory({{ category.id }}, '{{ category.name }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <form action="{{ url_for('baker.delete_category', category_id=category.id) }}" method="POST"
                                style="display: inline;"
                                onsubmit="return confirm('Delete this category? Products will become uncategorized.');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-sm"
                                    style="background: var(--danger); color: white;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-tags"></i>
            <h3>No categories yet</h3>
            <p>Create categories to organize your products</p>
        </div>
        {% endif %}
    </main>
</div>

<!-- Add Category Modal -->
<div id="addCategoryModal" class="modal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;">
    <div style="background: white; padding: var(--space-xl); border-radius: var(--radius-lg); width: 400px;">
        <h3 style="margin-bottom: var(--space-lg);">Add Category</h3>
        <form action="{{ url_for('baker.add_category') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <label>Category Name *</label>
                <input type="text" name="name" class="form-control" required>
            </div>
            <div style="display: flex; gap: var(--space-md);">
                <button type="submit" class="btn btn-primary">Add</button>
                <button type="button" class="btn btn-secondary"
                    onclick="document.getElementById('addCategoryModal').style.display='none'">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    function editCategory(id, name) {
        const newName = prompt('Edit category name:', name);
        if (newName && newName !== name) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/baker/category/' + id + '/edit';

            // Add CSRF token
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = '{{ csrf_token() }}';
            form.appendChild(csrfInput);

            // Add name
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'name';
            input.value = newName;
            form.appendChild(input);

            // Add is_active (assume active)
            const activeInput = document.createElement('input');
            activeInput.type = 'hidden';
            activeInput.name = 'is_active';
            activeInput.value = 'on';
            form.appendChild(activeInput);

            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}