{% extends 'base.html' %}

{% block title %}My Reviews{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1><i class="fas fa-star"></i> My Reviews</h1>
    </div>
</section>

<section class="section">
    <div class="container">
        {% if reviews %}
        <div class="reviews-grid" style="display: grid; gap: var(--space-lg); max-width: 800px; margin: 0 auto;">
            {% for review in reviews %}
            <div class="auth-card">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-md);">
                    <div>
                        <h4 style="margin: 0 0 var(--space-xs) 0;">
                            <a href="{{ url_for('bakery_detail', slug=review.bakery.slug) }}"
                                style="color: var(--primary); text-decoration: none;">
                                {{ review.bakery.name }}
                            </a>
                        </h4>
                        <span style="color: var(--gray-600); font-size: 0.875rem;">
                            {{ review.created_at.strftime('%b %d, %Y at %I:%M %p') }}
                        </span>
                    </div>
                    <div class="review-rating">
                        {% for i in range(5) %}
                        <i class="fas fa-star"
                            style="color: {% if i < review.rating %}#ffc107{% else %}var(--gray-300){% endif %};"></i>
                        {% endfor %}
                    </div>
                </div>

                {% if review.comment %}
                <p style="margin-bottom: var(--space-md); color: var(--gray-700);">{{ review.comment }}</p>
                {% endif %}

                {% if review.reply %}
                <div
                    style="background: var(--gray-50); padding: var(--space-md); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                    <strong style="color: var(--primary);"><i class="fas fa-reply"></i> Bakery Response:</strong>
                    <p style="margin: var(--space-sm) 0 0 0;">{{ review.reply }}</p>
                    {% if review.reply_at %}
                    <small style="color: var(--gray-500);">{{ review.reply_at.strftime('%b %d, %Y') }}</small>
                    {% endif %}
                </div>
                {% endif %}

                <div
                    style="display: flex; justify-content: space-between; align-items: center; padding-top: var(--space-md); border-top: 1px solid var(--gray-200);">
                    <a href="{{ url_for('order_detail', order_number=review.order.order_number) }}"
                        class="btn btn-secondary btn-sm">
                        <i class="fas fa-box"></i> View Order
                    </a>
                    <form action="{{ url_for('customer.delete_my_review', review_id=review.id) }}" method="POST"
                        onsubmit="return confirm('Are you sure you want to delete this review?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm" style="background: var(--danger); color: white;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state" style="text-align: center; padding: var(--space-3xl);">
            <i class="fas fa-star" style="font-size: 3rem; color: var(--gray-400); margin-bottom: var(--space-lg);"></i>
            <h3 style="margin: 0 0 var(--space-sm) 0;">No reviews yet</h3>
            <p style="color: var(--gray-600); margin: 0 0 var(--space-lg) 0;">You haven't written any reviews yet. Order
                from a bakery and share your experience!</p>
            <a href="{{ url_for('bakeries_list') }}" class="btn btn-primary">
                <i class="fas fa-store"></i> Browse Bakeries
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}